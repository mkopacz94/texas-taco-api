version: '3.4'

services:

  texastaco.api.gateway:
    image: ${DOCKER_REGISTRY-}texastacoapigateway
    build:
      context: .
      dockerfile: src/Gateway/TexasTaco.Api.Gateway/Dockerfile

  texastaco.authentication.api:
    image: ${DOCKER_REGISTRY-}texastacoauthenticationapi
    build:
      context: .
      dockerfile: src/Authentication/TexasTaco.Authentication.Api/Dockerfile
    depends_on:
      - authentication-db
      - authentication-cache
      - texastaco-mq

  texastaco.users.api:
    image: ${DOCKER_REGISTRY-}texastacousersapi
    build:
      context: .
      dockerfile: src/Users/TexasTaco.Users.Api/Dockerfile
    depends_on:
      - users-db
      - authentication-cache
      - texastaco-mq

  authentication-db:
    image: mysql
    container_name: authentication-db
    restart: always

  users-db:
    image: mysql
    container_name: users-db
    restart: always

  authentication-cache:
    image: redis:alpine
    container_name: authentication-cache
    restart: always

  texastaco-mq:
    image: rabbitmq:3-management
    container_name: texastaco-mq

volumes:
   authentication_db_volume:
   users_db_volume:



